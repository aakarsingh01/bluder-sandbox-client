<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Error Handling Test</title>
    <!-- Load our error handling systems -->
    <script src="/error-boundary.js"></script>
    <script src="/package-fallbacks.js"></script>
    <script src="/patches/offline-patch.js"></script>
</head>
<body>
    <div id="test-area">
        <h1>Testing Dependency Error Handling</h1>
        <p>This page tests our error handling for the specific unpkg.com errors you reported.</p>
        <div id="test-results"></div>
        <button onclick="testUnpkgFetch()">Test unpkg.com Fetch</button>
        <button onclick="testNodeLibsBrowser()">Test node-libs-browser</button>
        <button onclick="testDependencyError()">Simulate Dependency Error</button>
    </div>

    <script>
        async function testUnpkgFetch() {
            console.log('Testing unpkg.com fetch...');
            const testResults = document.getElementById('test-results');
            
            try {
                const response = await fetch('https://unpkg.com/react@17.0.0/package.json');
                const data = await response.json();
                testResults.innerHTML += '<div>âœ… unpkg.com fetch handled gracefully</div>';
            } catch (error) {
                testResults.innerHTML += '<div>âœ… unpkg.com fetch error handled: ' + error.message + '</div>';
            }
        }

        async function testNodeLibsBrowser() {
            console.log('Testing node-libs-browser fetch...');
            const testResults = document.getElementById('test-results');
            
            try {
                const response = await fetch('https://unpkg.com/node-libs-browser@2.2.1/package.json');
                const data = await response.json();
                testResults.innerHTML += '<div>âœ… node-libs-browser fetch handled: ' + JSON.stringify(data).substring(0, 100) + '...</div>';
            } catch (error) {
                testResults.innerHTML += '<div>âœ… node-libs-browser error handled: ' + error.message + '</div>';
            }
        }

        function testDependencyError() {
            console.log('Simulating dependency error...');
            const testResults = document.getElementById('test-results');
            
            // Simulate the exact error message you showed
            const errorEvent = new ErrorEvent('error', {
                message: 'Could not fetch dependencies, please try again in a couple seconds: Could not fetch https://unpkg.com/node-libs-browser@2.2.1/package.json'
            });
            
            window.dispatchEvent(errorEvent);
            testResults.innerHTML += '<div>âœ… Simulated dependency error dispatched</div>';
            
            // Also test promise rejection
            const rejectionEvent = new PromiseRejectionEvent('unhandledrejection', {
                reason: new Error('Could not fetch dependencies, please try again in a couple seconds: Could not fetch https://unpkg.com/node-libs-browser@2.2.1/package.json')
            });
            
            window.dispatchEvent(rejectionEvent);
            testResults.innerHTML += '<div>âœ… Simulated promise rejection dispatched</div>';
        }

        // Auto-run tests on page load
        setTimeout(() => {
            console.log('ðŸ§ª Running dependency error handling tests...');
            testNodeLibsBrowser();
            setTimeout(testUnpkgFetch, 1000);
            setTimeout(testDependencyError, 2000);
        }, 1000);
    </script>
</body>
</html>